<!-- app/templates/admin/create_edit_role.html -->
{# Template for creating or editing roles #}
{% extends "admin/base_admin.html" %}

{# Set the subtitle based on the title passed from the route #}
{% block subtitle %}{{ title }}{% endblock %}

{% block admin_head_extra %}
    {{ super() }}
    {# Spinner class is now handled by Tailwind utilities in JS if needed, or directly on elements #}
{% endblock %}

{% block admin_content %}
    <p class="text-sm text-gray-600 mb-6">{{ 'Define the details and permissions for the new role.' if 'Create' in title else 'Modify the details and permissions for this role.' }}</p>

    <form method="POST" action="" class="space-y-8">
        {{ form.hidden_tag() }}

        {# Basic Role Info #}
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
                <label for="{{ form.name.id }}" class="block text-sm font-medium text-gray-700">{{ form.name.label.text }}</label>
                {{ form.name(class="form-input mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring-primary sm:text-sm" + (" border-red-500" if form.name.errors else ""), required=True, autofocus=True, id=form.name.id) }}
                {% if form.name.errors %}
                    <p class="mt-2 text-sm text-red-600">{{ form.name.errors[0] }}</p>
                {% endif %}
            </div>
            <div>
                <label for="{{ form.description.id }}" class="block text-sm font-medium text-gray-700">{{ form.description.label.text }}</label>
                {{ form.description(class="form-textarea mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring-primary sm:text-sm" + (" border-red-500" if form.description.errors else ""), rows="3", id=form.description.id) }}
                {% if form.description.errors %}
                    <p class="mt-2 text-sm text-red-600">{{ form.description.errors[0] }}</p>
                {% endif %}
            </div>
        </div>

        {# Permissions Section #}
        <div>
            <h3 class="text-lg font-medium leading-6 text-gray-900">Permissions</h3>
            <div class="mt-4 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-x-6 gap-y-4">
                {# API Access Column #}
                <div class="space-y-3">
                    <h4 class="text-sm font-semibold text-gray-600">API Access</h4>
                    <label class="flex items-center space-x-2 cursor-pointer">
                        {{ form.use_api_assemblyai(class="form-checkbox h-4 w-4 text-primary border-gray-300 rounded focus:ring-primary") }}
                        <span class="text-sm text-gray-700">{{ form.use_api_assemblyai.label.text }}</span>
                    </label>
                    <label class="flex items-center space-x-2 cursor-pointer">
                        {{ form.use_api_openai_whisper(class="form-checkbox h-4 w-4 text-primary border-gray-300 rounded focus:ring-primary") }}
                        <span class="text-sm text-gray-700">{{ form.use_api_openai_whisper.label.text }}</span>
                    </label>
                    <label class="flex items-center space-x-2 cursor-pointer">
                        {{ form.use_api_openai_gpt_4o_transcribe(class="form-checkbox h-4 w-4 text-primary border-gray-300 rounded focus:ring-primary") }}
                        <span class="text-sm text-gray-700">{{ form.use_api_openai_gpt_4o_transcribe.label.text }}</span>
                    </label>
                    <label class="flex items-center space-x-2 cursor-pointer">
                        {{ form.use_api_google_gemini(class="form-checkbox h-4 w-4 text-primary border-gray-300 rounded focus:ring-primary") }}
                        <span class="text-sm text-gray-700">{{ form.use_api_google_gemini.label.text }}</span>
                    </label>
                </div>

                {# Feature Access Column #}
                <div class="space-y-3">
                    <h4 class="text-sm font-semibold text-gray-600">Feature Access</h4>
                    <label class="flex items-center space-x-2 cursor-pointer">
                        {{ form.allow_large_files(class="form-checkbox h-4 w-4 text-primary border-gray-300 rounded focus:ring-primary") }}
                        <span class="text-sm text-gray-700">{{ form.allow_large_files.label.text }}</span>
                    </label>
                    <label class="flex items-center space-x-2 cursor-pointer">
                        {{ form.allow_context_prompt(class="form-checkbox h-4 w-4 text-primary border-gray-300 rounded focus:ring-primary") }}
                        <span class="text-sm text-gray-700">{{ form.allow_context_prompt.label.text }}</span>
                    </label>
                    <label class="flex items-center space-x-2 cursor-pointer">
                        {{ form.allow_download_transcript(class="form-checkbox h-4 w-4 text-primary border-gray-300 rounded focus:ring-primary") }}
                        <span class="text-sm text-gray-700">{{ form.allow_download_transcript.label.text }}</span>
                    </label>
                    <label class="flex items-center space-x-2 cursor-pointer">
                        {{ form.allow_workflows(class="form-checkbox h-4 w-4 text-primary border-gray-300 rounded focus:ring-primary") }}
                        <span class="text-sm text-gray-700">{{ form.allow_workflows.label.text }}</span>
                    </label>
                    <label class="flex items-center space-x-2 cursor-pointer">
                        {{ form.allow_auto_title_generation(class="form-checkbox h-4 w-4 text-primary border-gray-300 rounded focus:ring-primary") }}
                        <span class="text-sm text-gray-700">{{ form.allow_auto_title_generation.label.text }}</span>
                    </label>
                </div>

                {# Account & Admin Column #}
                <div class="space-y-3">
                    <h4 class="text-sm font-semibold text-gray-600">Account & Admin</h4>
                    <label class="flex items-center space-x-2 cursor-pointer">
                        {{ form.allow_api_key_management(class="form-checkbox h-4 w-4 text-primary border-gray-300 rounded focus:ring-primary") }}
                        <span class="text-sm text-gray-700">{{ form.allow_api_key_management.label.text }}</span>
                    </label>
                    <label class="flex items-center space-x-2 cursor-pointer">
                        {{ form.access_admin_panel(class="form-checkbox h-4 w-4 text-primary border-gray-300 rounded focus:ring-primary") }}
                        <span class="text-sm text-gray-700">{{ form.access_admin_panel.label.text }}</span>
                    </label>
                    <label class="flex items-center space-x-2 cursor-pointer">
                        {{ form.manage_workflow_templates(class="form-checkbox h-4 w-4 text-primary border-gray-300 rounded focus:ring-primary") }}
                        <span class="text-sm text-gray-700">{{ form.manage_workflow_templates.label.text }}</span>
                    </label>
                </div>
            </div>
        </div>

        {# Limits Section #}
        <div>
            <h3 class="text-lg font-medium leading-6 text-gray-900">Usage Limits</h3>
            <p class="mt-1 text-xs text-gray-500">Set to 0 for unlimited.</p>
            <div class="mt-4 grid grid-cols-4 gap-x-6 gap-y-2 items-end">
                {# Headers #}
                <div class="col-start-2 text-sm font-semibold text-gray-600">Daily Quota</div>
                <div class="text-sm font-semibold text-gray-600">Weekly Quota</div>
                <div class="text-sm font-semibold text-gray-600">Monthly Quota</div>

                {# Costs Row #}
                <div class="text-sm font-medium text-gray-700 self-center">Costs ($)</div>
                <div>
                    {{ form.limit_daily_cost(type="number", min="0", step="0.01", class="form-input mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring-primary sm:text-sm" + (" border-red-500" if form.limit_daily_cost.errors else "")) }}
                </div>
                <div>
                    {{ form.limit_weekly_cost(type="number", min="0", step="0.01", class="form-input mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring-primary sm:text-sm" + (" border-red-500" if form.limit_weekly_cost.errors else "")) }}
                </div>
                <div>
                    {{ form.limit_monthly_cost(type="number", min="0", step="0.01", class="form-input mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring-primary sm:text-sm" + (" border-red-500" if form.limit_monthly_cost.errors else "")) }}
                </div>

                {# Minutes Processed Row #}
                <div class="text-sm font-medium text-gray-700 self-center">Minutes Processed</div>
                <div>
                    {{ form.limit_daily_minutes(type="number", min="0", step="1", class="form-input mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring-primary sm:text-sm" + (" border-red-500" if form.limit_daily_minutes.errors else "")) }}
                </div>
                <div>
                    {{ form.limit_weekly_minutes(type="number", min="0", step="1", class="form-input mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring-primary sm:text-sm" + (" border-red-500" if form.limit_weekly_minutes.errors else "")) }}
                </div>
                <div>
                    {{ form.limit_monthly_minutes(type="number", min="0", step="1", class="form-input mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring-primary sm:text-sm" + (" border-red-500" if form.limit_monthly_minutes.errors else "")) }}
                </div>

                {# Workflows Row #}
                <div class="text-sm font-medium text-gray-700 self-center">Workflows</div>
                <div>
                    {{ form.limit_daily_workflows(type="number", min="0", step="1", class="form-input mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring-primary sm:text-sm" + (" border-red-500" if form.limit_daily_workflows.errors else "")) }}
                </div>
                <div>
                    {{ form.limit_weekly_workflows(type="number", min="0", step="1", class="form-input mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring-primary sm:text-sm" + (" border-red-500" if form.limit_weekly_workflows.errors else "")) }}
                </div>
                <div>
                    {{ form.limit_monthly_workflows(type="number", min="0", step="1", class="form-input mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring-primary sm:text-sm" + (" border-red-500" if form.limit_monthly_workflows.errors else "")) }}
                </div>
            </div>

            {# History Limits #}
            <div class="mt-8 grid grid-cols-1 sm:grid-cols-2 gap-6">
                 <div>
                    <label for="{{ form.max_history_items.id }}" class="block text-sm font-medium text-gray-700">{{ form.max_history_items.label.text }}</label>
                    {{ form.max_history_items(type="number", min="0", step="1", class="form-input mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring-primary sm:text-sm" + (" border-red-500" if form.max_history_items.errors else ""), id=form.max_history_items.id) }}
                    {% if form.max_history_items.errors %}
                        <p class="mt-2 text-sm text-red-600">{{ form.max_history_items.errors[0] }}</p>
                    {% endif %}
                </div>
                <div>
                    <label for="{{ form.history_retention_days.id }}" class="block text-sm font-medium text-gray-700">{{ form.history_retention_days.label.text }}</label>
                    {{ form.history_retention_days(type="number", min="0", step="1", class="form-input mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring-primary sm:text-sm" + (" border-red-500" if form.history_retention_days.errors else ""), id=form.history_retention_days.id) }}
                    {% if form.history_retention_days.errors %}
                        <p class="mt-2 text-sm text-red-600">{{ form.history_retention_days.errors[0] }}</p>
                    {% endif %}
                </div>
            </div>
        </div>

        {# Submit Button #}
        <div class="pt-5">
            <div class="flex justify-start space-x-3">
                <button type="submit"
                        class="btn-save">
                    <i class="material-icons left tiny -ml-1 mr-2">save</i>{{ form.submit.label.text }}
                </button>
                <a href="{{ url_for('admin_panel.manage_roles') }}"
                   class="inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary">
                    Cancel
                </a>
            </div>
        </div>
    </form>
{% endblock %}

{% block admin_scripts %}
    {{ super() }}
    {# No specific JS needed for this page beyond base admin scripts #}
{% endblock %}