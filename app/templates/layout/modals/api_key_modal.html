<!-- app/templates/layout/modals/api_key_modal.html -->
{# API Key Modal - Implemented with Tailwind and Vanilla JS #}
{% import "layout/components/ui_helpers.html" as ui %}
{% if is_multi_user and current_user.role and current_user.role.allow_api_key_management %}
{% call ui.modal_shell('apiKeyModal', labelledby='apiKeyModalTitle', overlay_id='apiKeyModalOverlay', panel_id='apiKeyModalPanel', size='md', panel_classes='max-h-[90vh] flex flex-col') %}
    <div class="modal-header">
        <h3 id="apiKeyModalTitle" class="modal-title">
            {{ _('Manage API Keys') }}
        </h3>
        <button type="button" id="apiKeyModalCloseButtonHeader"
                class="ui-btn ui-btn--muted px-2 py-2 rounded-full"
                aria-label="Close modal">
            <i class="material-icons">close</i>
        </button>
    </div>
    <div class="modal-body space-y-6 overflow-y-auto">
        <p class="text-sm text-text-muted">
            {{ _('Enter your personal API keys for the transcription and workflow services. These keys are stored securely and used only for your transcription requests.') }}
            {{ _('You can get your keys here:') }}
            <ul class="list-disc list-inside ml-4 mt-1 space-y-1">
                <li><a href="https://platform.openai.com/api-keys" target="_blank" rel="noopener noreferrer" class="text-primary hover:underline">OpenAI</a></li>
                <li><a href="https://www.assemblyai.com/dashboard/signup" target="_blank" rel="noopener noreferrer" class="text-primary hover:underline">AssemblyAI</a></li>
                <li><a href="https://ai.google.dev/gemini-api/docs/api-key" target="_blank" rel="noopener noreferrer" class="text-primary hover:underline">Google</a></li>
            </ul>
        </p>
        <form id="apiKeyForm" class="space-y-4">
            <div>
                <label for="apiKeyServiceSelect" class="form-label">{{ _('API Service') }}</label>
                <select id="apiKeyServiceSelect" name="service" class="input-select">
                    <option value="" disabled selected>{{ _('Choose service') }}</option>
                    <option value="openai">{{ _('OpenAI (Whisper/GPT-4o)') }}</option>
                    <option value="assemblyai">{{ _('AssemblyAI') }}</option>
                    <option value="gemini">{{ _('Google (Gemini)') }}</option>
                </select>
            </div>
            <div>
                <label for="apiKeyInput" class="form-label">{{ _('API Key') }}</label>
                <input id="apiKeyInput" type="password" name="api_key" class="input-control" autocomplete="off">
            </div>
            {{ ui.button(_('Save Key'), variant='primary', type='submit', icon='save', icon_position='end', extra_classes='btn-save') }}
        </form>
        <div class="surface-divider"></div>
        <h5 class="text-lg font-medium text-text-strong">{{ _('Configured Keys') }}</h5>
        <ul class="divide-y divide-border-default">
            {% if user_permissions.use_api_openai_whisper or user_permissions.use_api_openai_gpt_4o_transcribe %}
            <li class="py-3 flex justify-between items-center">
                <span class="text-sm text-text-strong">{{ _('OpenAI (Whisper/GPT-4o)') }}</span>
                <div class="flex items-center">
                    <span id="openaiKeyStatus" class="text-sm text-text-muted mr-3">{{ _('Checking...') }}</span>
                    <span id="openaiKeyActions"></span>
                </div>
            </li>
            {% endif %}
            {% if user_permissions.use_api_assemblyai %}
            <li class="py-3 flex justify-between items-center">
                <span class="text-sm text-text-strong">{{ _('AssemblyAI') }}</span>
                <div class="flex items-center">
                    <span id="assemblyaiKeyStatus" class="text-sm text-text-muted mr-3">{{ _('Checking...') }}</span>
                    <span id="assemblyaiKeyActions"></span>
                </div>
            </li>
            {% endif %}
            {% if user_permissions.use_api_google_gemini %}
            <li class="py-3 flex justify-between items-center">
                <span class="text-sm text-text-strong">{{ _('Google (Gemini)') }}</span>
                <div class="flex items-center">
                    <span id="geminiKeyStatus" class="text-sm text-text-muted mr-3">{{ _('Checking...') }}</span>
                    <span id="geminiKeyActions"></span>
                </div>
            </li>
            {% endif %}
        </ul>
    </div>
    <div class="modal-footer">
        {{ ui.button(_('Close'), variant='muted', id='apiKeyModalCloseButtonFooter') }}
    </div>
{% endcall %}
{% endif %}
