<!-- app/templates/manage_prompts.html -->
{# Page for users to manage their saved workflow prompts #}
{% extends "base.html" %}
{% import "layout/components/form_layout.html" as form_layout %}
{% import "layout/components/ui_helpers.html" as ui %}

{% block title %}{{ _('Manage your Workflows') }}{% endblock %}

{% block head_extra %}
    {{ super() }}
    {# Custom styles for this page are minimal and handled by Tailwind utilities or inline styles where necessary #}
    {# Spinner styles are now handled by Tailwind utility classes on the button elements in JS #}
{% endblock %}

{% block content %}
<div class="py-8">
    {% call form_layout.card(
        title=_('Manage your Workflows'),
        description=_('Create, edit, or delete your reusable workflow prompts.'),
        wrapper_classes='w-full',
        padding_classes='p-6 md:p-8'
    ) %}
        {% call form_layout.section(title=_('Add New Workflow'), body_classes='space-y-6', divider=True) %}
            <form id="addPromptForm" class="space-y-6">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 items-end">
                    <div class="md:col-span-2">
                        <label for="newPromptTitle" class="form-label">{{ _('Workflow Label') }}</label>
                        <input type="text" id="newPromptTitle" name="title" required maxlength="100"
                               class="input-control">
                    </div>
                    <div>
                        <label class="form-label">{{ _('Label Color') }}</label>
                        <div class="mt-1 flex items-center flex-wrap gap-2" id="newPromptColorOptions">
                            {# Color options populated by JS #}
                        </div>
                        <input type="hidden" id="newPromptColor" name="color" value="#ffffff">
                    </div>
                </div>

                <div>
                    <label for="newPromptText" class="form-label">{{ _('Workflow Prompt') }}</label>
                    <textarea id="newPromptText" name="prompt_text" rows="3" required maxlength="1000"
                              class="input-textarea"></textarea>
                </div>

                <div>
                    {{ ui.button(
                        _('Add Workflow'),
                        variant='success',
                        type='submit',
                        icon='add',
                        icon_position='start',
                        extra_classes='disabled:opacity-50 disabled:cursor-not-allowed'
                    ) }}
                </div>
            </form>
        {% endcall %}

        {% call form_layout.section(title=_('Your Saved Workflows')) %}
            <ul class="divide-y divide-border-default -mx-6 md:-mx-8" id="savedPromptsList">
                <li class="p-6 text-center text-text-muted" id="prompts-placeholder"
                    data-loading-text="{{ _('Loading workflows...') }}"
                    data-empty-text="{{ _('You have no saved workflows yet.') }}"
                    data-error-text="{{ _('Error loading workflows:') }}"
                >{{ _('Loading workflows...') }}</li>
            </ul>
        {% endcall %}
    {% endcall %}

    {% call ui.modal_shell('editPromptModal', labelledby='editPromptModalTitle', overlay_id='editPromptModalOverlay', panel_id='editPromptModalPanel', size='md', panel_classes='max-h-[90vh] flex flex-col') %}
        <div class="modal-header">
            <h3 id="editPromptModalTitle" class="modal-title">
                {{ _('Edit Workflow') }}
            </h3>
            <button type="button" id="editPromptModalCloseButtonHeader"
                    class="ui-btn ui-btn--muted px-2 py-2 rounded-full"
                    aria-label="Close modal">
                <i class="material-icons">close</i>
            </button>
        </div>
        <div class="modal-body space-y-6 overflow-y-auto">
            <form id="editPromptForm" class="space-y-6">
                <input type="hidden" id="editPromptId" name="prompt_id">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 items-end">
                    <div class="md:col-span-2">
                        <label for="editPromptTitle" class="form-label">{{ _('Workflow Label') }}</label>
                        <input type="text" id="editPromptTitle" name="title" required maxlength="100"
                               class="input-control">
                    </div>
                    <div>
                        <label class="form-label">{{ _('Label Color') }}</label>
                        <div class="mt-1 flex items-center flex-wrap gap-2" id="editPromptColorOptions">
                            {# Color options populated by JS #}
                        </div>
                        <input type="hidden" id="editPromptColor" name="color" value="#ffffff">
                    </div>
                </div>
                <div>
                    <label for="editPromptText" class="form-label">{{ _('Workflow Prompt') }}</label>
                    <textarea id="editPromptText" name="prompt_text" rows="2" required maxlength="1000"
                              class="input-textarea min-h-[10rem]"></textarea>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            {{ ui.button(_('Cancel'), variant='muted', id='editPromptModalCloseButtonFooter') }}
            {{ ui.button(_('Save Changes'), variant='primary', type='submit', icon='save', icon_position='end', id='saveEditPromptBtn', attrs='form="editPromptForm"') }}
        </div>
    {% endcall %}
</div>
{% endblock %}

{% block scripts %}
    {{ super() }}
    <script src="{{ url_for('static', filename='js/manage_prompts.js') }}"></script>
{% endblock %}
